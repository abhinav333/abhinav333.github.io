<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-03-11T14:39:16-05:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Abhinav Kulkarni</title><subtitle>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</subtitle><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;&quot;/assets/images/oogway.jpg&quot;, &quot;bio&quot;=&gt;&quot;Curious researcher. Contributing towards science.&quot;, &quot;location&quot;=&gt;&quot;Trois-Rivières, QC, Canada&quot;, &quot;links&quot;=&gt;[{&quot;label&quot;=&gt;&quot;GitHub&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-github&quot;, &quot;url&quot;=&gt;&quot;https://github.com/abhinav333&quot;}]}</name></author><entry><title type="html">Interfacing SD with AVR: Part 3</title><link href="http://localhost:4000/embedded%20systems/2020/08/28/sd-card-3.html" rel="alternate" type="text/html" title="Interfacing SD with AVR: Part 3" /><published>2020-08-28T00:00:00-04:00</published><updated>2020-08-28T00:00:00-04:00</updated><id>http://localhost:4000/embedded%20systems/2020/08/28/sd-card-3</id><content type="html" xml:base="http://localhost:4000/embedded%20systems/2020/08/28/sd-card-3.html"><![CDATA[<p>Data on storage media  is organised using filesytem. Computer operating system is able to access contents of the storage media via filesystem. We will use Fat Allocation Table (FAT) to format our SD Card. Additional information on FAT file system is available online [1]. To access contents on SDC with FAT on MCU, we need an external C library FATFs, which abstracts low-level commands for handling SDC transactions. However, for tiny 8-bit MCU like Atmega16, we can use Petit FATFs (variant of FATFs) with smaller code footprint and lesser functionality. </p>

<p>We know from tutorial 1 that MCU and SDC fundamentally communicates using SPI protocol (SDC has internal MCU which communicates with Atmega16). Functioning of Petit FATfs can be organized into 3 level hierarchy as shown in Fig 1.  The lower level is MCU dependent and handles SPI transactions. Middle level handles disk I/O functions as per MMC/SD standard protocol. The highest layer handles the application interface for Petit FATfs.</p>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAk8AAAGHCAYAAACplLYqAAAEknRFWHRteGZpbGUAJTNDbXhmaWxlJTIwaG9zdCUzRCUyMmFwcC5kaWFncmFtcy5uZXQlMjIlMjBtb2RpZmllZCUzRCUyMjIwMjAtMDgtMjhUMTglM0E0NyUzQTQxLjI5NVolMjIlMjBhZ2VudCUzRCUyMjUuMCUyMChXaW5kb3dzKSUyMiUyMGV0YWclM0QlMjJESE80Vm5ybHBoUnFRRk5PdkZsbyUyMiUyMHZlcnNpb24lM0QlMjIxMy42LjUlMjIlMjB0eXBlJTNEJTIyZGV2aWNlJTIyJTNFJTNDZGlhZ3JhbSUyMGlkJTNEJTIyWFlTMFVpTGRQUGs2d3g4U04ta0IlMjIlMjBuYW1lJTNEJTIyUGFnZS0xJTIyJTNFNVpmSmJ0c3dFSWFmUnNjYXNoWmJQc1pMMGdJSlVNQW9taDVwa1pJWVV4cUJvaGYxNlV0YUkwdUsxNlpKa1NDQUQlMkJRJTJGdyUyQjBmZm9Sc3VaTjBleWRKbmp3QVpjSnliTHExM0tubE9IM1BjU3p6czJsWktjTlJ2eEppeVNrbU5jS2MlMkYyWW8ycWl1T0dWRkoxRUJDTVh6cmhoQ2xyRlFkVFFpSld5NmFSR0k3cW81aWRtQk1BJTJCSk9GUiUyRmNxcVNTZzE4dTlHJTJGTWg0bjljcDlHeU1wcVpOUktCSkNZZE9TM0pubFRpU0FxbHJwZHNLRU1hJTJGMnBScDNleUs2MzVoa21icG1nR3NIVTFqS2IlMkZUUkd3MiUyQmUzNzJ4SDk4d2Vxc2lWamhnVlBDczE2SVcxWmw3WU9FVlVhWm1hcHZ1ZU5Od2hXYjV5UTAwWTJ1dk5ZU2xRb01SMXlJQ1FpUXU3RXVKU3lJUXEwWFNzS1N0U0tETUdDTFNFY09ENFBuV3pPcDJMWWw0ZUh1R0tSTXlWS243TzhhR28wM3JWOGJ2Mm5xNW85UVMxbzFHNkJHOEtyRSUyQjZrYk4zVUREZjBMYzRjSExqS3FMeGQyUWFvRVlzaUltRFhxdVBIWjFyMG01eDRnUjNlZm1GSWxra0pXQ3JyZWF3TmwlMkJXakc5JTJGeTYlMkI2c2RtMjV4OHFwWFl1OWtCUXBZeVpDZE9hYUhXQklaTTNYNXJoa1B6dFpUTWtFVVgzY0JmUFhpZUFjMzMzSUdRdTklMkZUUGxhTjJPMU02V1NGclZ3ayUyQmVDaDNwN2tPbkJncTNOYzFmbDZGMHNubyUyRlQycEhaV3RJdEYlMkJaMXV6SFdSMUZvd0p0VTdWNnliJTJCcTNMVElSM0l1OHRNcSUyRm9Qc0tJRHJETG9qT0VSQmQ5MyUyQkNPUGdjSVBwWGd1aTlLeEQ5RjRINHdDblZkYnFDd2N1OG5LTXlUWGRRMmhXTWxCZExEZ2JORDBIZW5ySkw1QTNmaXJ6UjV5QXZ1Skk4JTJGMTJSRjV3a2J3JTJGUnZmNWlmUkZqeDJrcWN2NWg0UEc4dDROSGQ1c1AlMkYxMnM5ZmZKbmYwQiUzQyUyRmRpYWdyYW0lM0UlM0MlMkZteGZpbGUlM0U0gl55AAAgAElEQVR4nO3d3W9c530n8INcUAVKXgk2DPkFvhCqXswfoYu9WRiwidxJMmE5MJoAiRG6ciJngV4kF5bgF6b1JpCV2rVhaq14Wdgw4iZdq41jpw6IJLVS7DpQzcJpEnqdm+12RUhwVIffvXAf9nA0w5mhXs4j6fMBvoDImTPzcPz4xy/ODGeaDPBvH6/n1E9+lWdfezePHHs7T750Ol9YeENE5KrliZPvdL4GEbmx8uRLp/PIsbfz7F/9PH/zk1/l49+tD6pJafq/8YN3VvPHT72V5/76vfzdz/9ffvaL83nvNx+LiIiIXPf52S/O54fv/t8897338sU//UHe/Nnq1uXpxP84k79865edL1xERESkhiy9+cu89Lcrg8vTidf/MSe//4vOFykiIiJSU1782/dz8tQ/bi5P339nNX/51j93vjgRERGRGrP01i/z5ulPnsJr/u3j9fzxf32r80WJiIiI1Jz5P3sz6+tJc+onv8pzf73S+YJEREREas6z330v3//7X6d55rV383fv/mvnCxIRERGpOT9891/zF6+9m+bwsbe9HYGIiIjIiJx+/3y+8vTbaZ749unOFyMiIiJyLeSJb7+T5gsLb3S+EBEREZFrIV9YeEN5EhERERk3ypOIiIjIBFGeRERERCaI8iQiIiIyQZQnERERkQmiPImIiIhMEOVJREREZIIoTyIiIiITRHkSERERmSDKk4iIiMgEUZ5EREREJojyJCIiIjJBlCcRERGRCaI8iYiIiEwQ5UlERERkgihPIlJtfnj6l2maJkvffbvztYiIlChPIiIiIhNEeRKRK5KmafKVrz6RpmnSNE0O/tEX89Sfv7Tx9Ve++sTGddvfL9d97zebzzyVfx/8oy8OvI1B91/S9WMhItdXlCcRuSJpl6Cl77696etSltrXLU/Nlct+ePqXQ8vToNto5w/+sJen/vylvPebj/OVrz6xcYyIyOWI8iQiVyT9r1Vqf12KUClI7eP6L+svT+X6/V+XlKLWf5tdPx4icv1EeRKRK5Jxy9N7v/l409N7JZezPImIXM4oTyJyRTJueSplZ1ApUp5EpMYoTyJyRTJpeSrX+0//+Z5LKk/99/WVrz6RP/jDXuePh4hcP1GeROSKZJKn7UphapomT/35Sxsv+B63PJV/l/sqX/trOxG5ElGeRERERCaI8iQiIiIyQZQnERERkQmiPImIiIhMEOVJREREZIIoTyIiIiITRHkSERERmSDKk4iIiMgEUZ5EREREJojyJCIiIjJBlCcRERGRCaI8iYiIiEwQ5UlERERkgihPIiIiIhNEeRIRERGZIMqTiIiIyAT5wsIbaZ749judL0RERETkWsgT3z6d5vCxt/OzX5zvfDEiIiIiNef0++fzlaffTvPsaz/PD9/9184XJCIiIlJz3nr3X/LcX/08zd/85Fd57nvvdb4gERERkZrz7Hffy/f//tdpPv7der74pz/ofEEiIiIiNefBhTeynqRJkh+cXs1fvvnPnS9KREREpMYsvfnPeesfPkhKeUqSl/52Jf/tb97vfHEiIiIiNeXEqfez9MY/lcr0H+UpSU6e+sf89x/8svNFioiIiNSQl37wiyx9/5/adWlzeUqSN0+vZv7P3sxffO+9vPW//iXvvH+u84WLiIiIXI288/65vPk//0/+4nvv5cGFN/LDf/jf/VXp4vKUJOvryff//td57rs/z385/nae/PbpfGHhDRGRq5YnTr7T+RpE5MbKE98+nf9y/O0891c/zxvv/Drrg0rSsPIE0KULFy5k//79uXDhQtdLAbiI8gRU5+jRo5mamsqRI0e6XgrARZQnoDo7duxI0zTZsWNH10sBuIjyBFTl6NGjm8qTs09AbZQnoCqlOJU4+wTURnkCqnHkyJGN8jQzM7NRnh599NGulwawQXkCqjE1NZWbbropt956a5qmya5du3LzzTdnamqq66UBbFCegCqcOnUq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" alt="" /></p>

<p>Fig 1. Petit FATfs usage.</p>

<p>  
1)Low level functionality:</p>

<p>This level handles SPI initialization and SPI read/write byte operations. For Atmega16, refer to datasheet [2] to understand how SPI works. SPI clock frequency needs to be set as per the requirement. One such template file can is available for Atmega16 [3] .You can also find assembly code implementation to handle SPI from PetitFAT sample projects in resource section.</p>

<p> </p>

<p>2) Middle level</p>

<p>This level handles disk I/O functionality and abstracts MMC/SD commands. Specifically, it initializes SDC and provides API for card sector modification. More information on MMC/SDC usage can be found on the project website [4]. SPI command set provides set of available commands, while a specific SPI response is received by MCU on issuing a SPI command to SDC. These responses are useful in debug process and can be monitored using LCD module. </p>

<p>The whole process is summarized in Fig 2. and is handled by disk_initialize function.To debug card initialization, ocr variable value can be checked using LCD screen after getting command response in disk_initialize function.You can find the disk I/O functions in mmc.c (or avr_mmcp.c) and it’s configuation in diskio.h .</p>

<p><img src="http://elm-chan.org/docs/mmc/i/sdinit.png" alt="http://elm-chan.org/docs/mmc/i/sdinit.png" /></p>

<p>Fig 2. SDC Intialization (source: from [4])</p>

<p>3) High level functionality</p>

<p>This layer uses the disk I/O layer API to provide Petit FATfs API for application interface. You can find the functions in pff.c and definitions in pff.h . It is possible to customize API functions as per requirements using file pffconf.h. Include pff files in your main.c and use the API application interface for handling file management on SD Card.</p>

<p>This completes the three part tutorial on interfacing and handling SD Card for MCU like Atmega16. It is advised to use an SDC with storage capacity &lt;2 GB for initial testing. Hope you find it useful!</p>

<p>References:</p>

<p>[1] https://en.wikipedia.org/wiki/File_Allocation_Table </p>

<p>[2] ww1.microchip.com/downloads/en/DeviceDoc/doc2466.pdf</p>

<p>[3] https://github.com/abhinav333/BRAILLE_READER/blob/master/spi.h</p>

<p>[4] http://elm-chan.org/docs/mmc/mmc_e.html</p>]]></content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;&quot;/assets/images/oogway.jpg&quot;, &quot;bio&quot;=&gt;&quot;Curious researcher. Contributing towards science.&quot;, &quot;location&quot;=&gt;&quot;Trois-Rivières, QC, Canada&quot;, &quot;links&quot;=&gt;[{&quot;label&quot;=&gt;&quot;GitHub&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-github&quot;, &quot;url&quot;=&gt;&quot;https://github.com/abhinav333&quot;}]}</name></author><category term="embedded systems" /><summary type="html"><![CDATA[Data on storage media  is organised using filesytem. Computer operating system is able to access contents of the storage media via filesystem. We will use Fat Allocation Table (FAT) to format our SD Card. Additional information on FAT file system is available online [1]. To access contents on SDC with FAT on MCU, we need an external C library FATFs, which abstracts low-level commands for handling SDC transactions. However, for tiny 8-bit MCU like Atmega16, we can use Petit FATFs (variant of FATFs) with smaller code footprint and lesser functionality. ]]></summary></entry><entry><title type="html">Interfacing SD with AVR: Part 2</title><link href="http://localhost:4000/embedded%20systems/2014/11/12/sd-card-2.html" rel="alternate" type="text/html" title="Interfacing SD with AVR: Part 2" /><published>2014-11-12T00:00:00-05:00</published><updated>2014-11-12T00:00:00-05:00</updated><id>http://localhost:4000/embedded%20systems/2014/11/12/sd-card-2</id><content type="html" xml:base="http://localhost:4000/embedded%20systems/2014/11/12/sd-card-2.html"><![CDATA[<p>In this part of the tutorial, we will see how SD-Card is wired with ATMEGA16. SD-Card requires a 3.3 V supply, so we will first make a circuit for the same purpose. You can use  voltage regulators like LM117(fixed 3.3 V output) or variable one like the popular LM317. There is no need to heat sink these IC’s for present application, as the power dissipation is quite small. I prefer using LM317 (TO-223 pacakage) ;It can be easily soldered, is easily available and the circuit needs only a few supplementary passive components.Go ahead with the following circuit.</p>

<p><a href="http://4.bp.blogspot.com/-ZGYNqD9oejg/VInXKMh0DWI/AAAAAAAAAF0/BQkbgk6eulo/s1600/LM317-typical-adjustable-regulator-ckt.png"><img src="http://4.bp.blogspot.com/-ZGYNqD9oejg/VInXKMh0DWI/AAAAAAAAAF0/BQkbgk6eulo/s1600/LM317-typical-adjustable-regulator-ckt.png" alt="" /></a></p>

<p> Tested with R2=360 Ohm and R1=240 Ohm.</p>

<p>If you get an output voltage with about deviation under 200 milivolts from 3.3 V, its perfect! Else, try tweaking the values of the resistors a little bit until you get that. Well, we now constructed a  power supply for the card. The next step is to build a logic converter circuit to interface AVR with SD Card. Its not always necessary to have an interface circuit, however it’s essential if the AVR is operating at a voltage other than 3.3 V. When not working with same voltage, the SD Card needs a logic level converter to convey its 3.3 V signal to  AVR and vice versa. There are a couple of methods to build one, however we will be going with voltage divider method, as I think it’s far simpler and works almost all of the time. However, you can explore other methods like the pull resistor method or you would be lucky to get  a readymade IC for the purpose.</p>

<p>Voltage divider method:</p>

<p><a href="http://3.bp.blogspot.com/-6EYS98w0DM8/VInXTcMeVwI/AAAAAAAAAGA/gwmLUi8Mh7E/s1600/interface.jpg"><img src="http://3.bp.blogspot.com/-6EYS98w0DM8/VInXTcMeVwI/AAAAAAAAAGA/gwmLUi8Mh7E/s1600/interface.jpg" alt="" /></a></p>

<p>With Vs as the primary supply voltage to system, calculation of R2 and R1 is pretty simple:</p>

<p><a href="http://3.bp.blogspot.com/-WdVOgJmvsiU/VInXJOpxpFI/AAAAAAAAAFw/JDK0tNva_bE/s1600/CodeCogsEqn.gif"><img src="http://3.bp.blogspot.com/-WdVOgJmvsiU/VInXJOpxpFI/AAAAAAAAAFw/JDK0tNva_bE/s1600/CodeCogsEqn.gif" alt="" /></a></p>

<p><a href="http://2.bp.blogspot.com/-OR80n4o9SeQ/VInXId75K8I/AAAAAAAAAFo/vIA6g5eI06Q/s1600/CodeCogsEqn%2B(1).gif"><img src="http://2.bp.blogspot.com/-OR80n4o9SeQ/VInXId75K8I/AAAAAAAAAFo/vIA6g5eI06Q/s1600/CodeCogsEqn%2B(1).gif" alt="" /></a></p>

<p><a href="http://1.bp.blogspot.com/-cCInlTvLRK4/VInXILUhs2I/AAAAAAAAAFg/q-mEIbwVvk4/s1600/CodeCogsEqn%2B(2).gif"><img src="http://1.bp.blogspot.com/-cCInlTvLRK4/VInXILUhs2I/AAAAAAAAAFg/q-mEIbwVvk4/s1600/CodeCogsEqn%2B(2).gif" alt="" /></a></p>

<p>Now lets say your microcontroller is working on 5 V, then ratio R2 comes out to be twice of R1. </p>

<p><a href="http://4.bp.blogspot.com/-AMaNu2Hf9XY/VInXIexvVsI/AAAAAAAAAFs/AVVNXhcn-G8/s1600/CodeCogsEqn%2B(3).gif"><img src="http://4.bp.blogspot.com/-AMaNu2Hf9XY/VInXIexvVsI/AAAAAAAAAFs/AVVNXhcn-G8/s1600/CodeCogsEqn%2B(3).gif" alt="" /></a></p>

<p>Try R2 and R1 as per your convenience, in range of 1 KOhm - 50 KOhm. I had successfully tested this circuit with R2 = 2.2 KOhm , R1 = 1.1 KOhm.</p>

<p>Having done that, power the SD Card with 3.3 V power supply,  which we had made using LM317. You can even design both the circuits(supply and logic converter) on same board, it will be actually  simple that way. </p>

<p>Usually, we don’t get 9 Pin MMC card in market nowadays as they have become obsolete. However, there are a variety of microSD cards available, which are compatible with cellphones, mp3 players and other such sort of devices. So, we can comfortably use such a microSD card with adapter(the black one) to serve our purpose .This  adapter needs  another card socket, which requires great care in soldering. Also, its SMD soldering pads are very fine and delicate. </p>

<p><a href="http://2.bp.blogspot.com/-iNkwGUAKXic/VIndu-2cK1I/AAAAAAAAAGM/O1teWl5GqdA/s1600/2gb-tf-and-adapter.jpg"><img src="http://2.bp.blogspot.com/-iNkwGUAKXic/VIndu-2cK1I/AAAAAAAAAGM/O1teWl5GqdA/s1600/2gb-tf-and-adapter.jpg" alt="" /></a></p>

<p>microSD with Adapter</p>

<p><a href="http://4.bp.blogspot.com/-tcwWbrfsOC0/VIndwGQ4x2I/AAAAAAAAAGU/CiJjsTTxKpI/s1600/SD.jpg"><img src="http://4.bp.blogspot.com/-tcwWbrfsOC0/VIndwGQ4x2I/AAAAAAAAAGU/CiJjsTTxKpI/s1600/SD.jpg" alt="" /></a></p>

<p>SD Card Adapter Socket</p>

<p>Well here’s a trick if dont’t want to mess up with SMD connector. It could save your time and efforts(and frustration too!). Solder a 9 X 1 male  berg strip to pinouts of adapter as shown in the figure below. Solder a 9 X 1 female berg strip as you pin out on the interface circuit. This method allows easy plug-in and out of adapter without damaging it.</p>

<p><a href="http://1.bp.blogspot.com/-j3aXOAanOtc/VIngt84gS1I/AAAAAAAAAGo/weFwAZ0ptU4/s1600/20141211-0001.jpeg"><img src="http://1.bp.blogspot.com/-j3aXOAanOtc/VIngt84gS1I/AAAAAAAAAGo/weFwAZ0ptU4/s1600/20141211-0001.jpeg" alt="" /></a></p>

<p><a href="http://1.bp.blogspot.com/-nzfO3KfXAFk/VIngruA24_I/AAAAAAAAAGg/TPKV2EUHdAs/s1600/20141211-0002.jpeg"><img src="http://1.bp.blogspot.com/-nzfO3KfXAFk/VIngruA24_I/AAAAAAAAAGg/TPKV2EUHdAs/s1600/20141211-0002.jpeg" alt="" /></a></p>]]></content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;&quot;/assets/images/oogway.jpg&quot;, &quot;bio&quot;=&gt;&quot;Curious researcher. Contributing towards science.&quot;, &quot;location&quot;=&gt;&quot;Trois-Rivières, QC, Canada&quot;, &quot;links&quot;=&gt;[{&quot;label&quot;=&gt;&quot;GitHub&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-github&quot;, &quot;url&quot;=&gt;&quot;https://github.com/abhinav333&quot;}]}</name></author><category term="embedded systems" /><summary type="html"><![CDATA[In this part of the tutorial, we will see how SD-Card is wired with ATMEGA16. SD-Card requires a 3.3 V supply, so we will first make a circuit for the same purpose. You can use  voltage regulators like LM117(fixed 3.3 V output) or variable one like the popular LM317. There is no need to heat sink these IC’s for present application, as the power dissipation is quite small. I prefer using LM317 (TO-223 pacakage) ;It can be easily soldered, is easily available and the circuit needs only a few supplementary passive components.Go ahead with the following circuit.]]></summary></entry><entry><title type="html">Interfacing SD with AVR: Part 1</title><link href="http://localhost:4000/embedded%20systems/2014/09/30/sd-card-1.html" rel="alternate" type="text/html" title="Interfacing SD with AVR: Part 1" /><published>2014-09-30T00:00:00-04:00</published><updated>2014-09-30T00:00:00-04:00</updated><id>http://localhost:4000/embedded%20systems/2014/09/30/sd-card-1</id><content type="html" xml:base="http://localhost:4000/embedded%20systems/2014/09/30/sd-card-1.html"><![CDATA[<p>This is the first part in the tutorial series which will guide you to use a SD Card for your projects with AVR ATMEGA. Secure Disk Card (SDC) is a versatile and compact storage peripheral. It is widely used for file storage, owing to its small size and compatibly with almost all of the digital devices. Application of SD-CARD can be extended to overcome data storage limits in embedded systems. In this tutorial, we will be seeing how to interface SD-Card with AVR family microcontroller .  We will be using the popular ATMEGA 16  for demonstration, but the method can be extended to any 8 bit MCU. However, as a prerequisite , I urge you to brush up your C programming and go through datasheet of ATMEGA16 (particularly the SPI part).   </p>

<p>So, let’s have a quick review of the basics of SD card. SDC is the upgraded standard of Multimedia Card with improved compatibility with numerous digital devices and has remarkably higher storage capacity. It contains array of flash memory and  inbuilt microcontroller to handle data requests. SDC supports two protocols; SD and SPI (Serial Peripheral Interface). We will be using the SPI protocol, as it easy and provides  speed about 100 KHz-500 Kz, which is sufficient for various application on ATMEGA16.</p>

<p>Although older versions of Multimedia Cards( MMC)  are out of fashion, recent SD-Card follows the same pin connections for SPI . microSD is widely used today due to its convenient design which suits most of the digital devices and can be easily adopted for SD interface using a suitable adapter. As we will be using SPI mode, we have to be only concerned about four SPI and two power supply  pin, no matter which type of card is used.</p>

<p><img src="http://2.bp.blogspot.com/-gBVaXGsMyHw/VC2Qz6S_kCI/AAAAAAAAAD0/Ch2N8fR4Png/s1600/MMC-SD-miniSD-microSD-Color-Numbers-Names.gif" alt="" /></p>

<p><img src="http://1.bp.blogspot.com/-ugJUG4TRjK4/VC2Q890YiZI/AAAAAAAAAD4/te-OPZGysuE/s1600/sd-card-pinout.png" alt="" /></p>

<p>Diagram shows pinouts of microSD, SD and MMC card. MicroSD can be easily turned into SD with Adapter.</p>

<h3 id="spi-mode"><strong>SPI Mode</strong></h3>

<p>Serial Peripheral Interface (SPI) enables synchronous communication between two devices supporting this protocol with efficient speed. ATMEGA16 (acts as master) communicates with microcontroller in SDC (acts as slave) using SPI protocol. This mode is characterized by MISO, MOSI, CS and SCLK (refer datasheet ATMEGA16 ) :</p>

<p><strong>Master In Slave Out (MISO)</strong>:  Data  transferred from slave to master device.</p>

<p><strong>Master Out Slave In (MOSI)</strong>:  Data transferred from master to slave device.</p>

<p><strong>CS</strong>: Active Low chip selection of slave by master.</p>

<p><strong>SCLK</strong>: Clock Line provided by master to slave for maintaining synchronization between the two.</p>

<p>SDC works on 3.3V logic and also needs same supply voltage. ATMEGA16 can operate on 3.3V and in such case we can directly connect both the peripherals. But in most of the applications, ATMEGA16 is powered by 5V DC supply. So there is a need of logic conversion circuitry in between the two peripherals . There are several methods of building one, you can search on internet. However,I personally would suggest  the simple resistor network circuit, being practically tested the same.  <br />
                  
Please visit <a href="http://maxembedded.com/2013/11/the-spi-of-the-avr/">maxembedded</a> if you are more curious learn more about SPI.</p>]]></content><author><name>{&quot;name&quot;=&gt;nil, &quot;avatar&quot;=&gt;&quot;/assets/images/oogway.jpg&quot;, &quot;bio&quot;=&gt;&quot;Curious researcher. Contributing towards science.&quot;, &quot;location&quot;=&gt;&quot;Trois-Rivières, QC, Canada&quot;, &quot;links&quot;=&gt;[{&quot;label&quot;=&gt;&quot;GitHub&quot;, &quot;icon&quot;=&gt;&quot;fab fa-fw fa-github&quot;, &quot;url&quot;=&gt;&quot;https://github.com/abhinav333&quot;}]}</name></author><category term="embedded systems" /><summary type="html"><![CDATA[This is the first part in the tutorial series which will guide you to use a SD Card for your projects with AVR ATMEGA. Secure Disk Card (SDC) is a versatile and compact storage peripheral. It is widely used for file storage, owing to its small size and compatibly with almost all of the digital devices. Application of SD-CARD can be extended to overcome data storage limits in embedded systems. In this tutorial, we will be seeing how to interface SD-Card with AVR family microcontroller .  We will be using the popular ATMEGA 16  for demonstration, but the method can be extended to any 8 bit MCU. However, as a prerequisite , I urge you to brush up your C programming and go through datasheet of ATMEGA16 (particularly the SPI part).   ]]></summary></entry></feed>